# 🔍 系統測試報告 - 問題清單

測試日期：2025-11-06

---

## 🔴 嚴重問題（必須修正）

### 1. Google Apps Script 缺少 doGet 函式

**問題描述：**
- 測試 URL 時顯示：`Script function not found: doGet`
- 這表示您的 Google Apps Script 編輯器中沒有 `doGet` 函式

**影響：**
- 無法測試 Script 是否正常運作
- 無法驗證部署是否成功

**修正方法：**
```javascript
// 請在您的 Google Apps Script 中加入這個函式
function doGet(e) {
  return ContentService.createTextOutput(
    JSON.stringify({
      status: 'ok',
      message: 'Google Apps Script is working!',
      timestamp: new Date().toISOString()
    })
  ).setMimeType(ContentService.MimeType.JSON);
}
```

**步驟：**
1. 開啟 Google Apps Script 編輯器
2. 完整複製 `google-apps-script-example.js` 的內容（包含 doPost 和 doGet）
3. 貼到編輯器中，取代所有現有內容
4. 點擊「儲存」
5. 重新部署（建立新版本）
6. 測試 URL：https://script.google.com/macros/s/AKfycbybgAY_0NKmVBHOUX0hC-jwJzT66fXwu_eDKh1bDfNoPuKZncmfq8nLAAJQawMnmXCu5w/exec

---

## ⚠️ 中等問題（需要注意）

### 2. 表單驗證不完整

**問題描述：**
- StepOne 有 `required` 屬性，但沒有實際驗證
- 使用者可能在未填寫必填欄位時點擊「下一步」

**影響：**
- 可能送出不完整的資料
- 使用者體驗不佳

**建議修正：**
- 在 `onNext` 時檢查必填欄位
- 顯示錯誤訊息提示使用者
- 或使用 HTML5 表單驗證（將按鈕改為 submit type）

**目前狀態：**
- ✅ 表單欄位有 `required` 屬性
- ❌ 沒有 JavaScript 驗證
- ❌ 沒有錯誤訊息顯示

---

### 3. 統一編號驗證不夠嚴謹

**問題描述：**
- 只驗證格式（8位數字），沒有驗證統一編號的邏輯規則
- 台灣統一編號有特定的檢查碼算法

**影響：**
- 可能接受無效的統一編號
- 可能導致開立發票時出錯

**目前實作：**
```typescript
pattern="[0-9]{8}"
maxLength={8}
```

**建議改進：**
加入統一編號檢查碼驗證算法（可選）

**是否需要修正：**
- 如果只是記錄資料：不需要
- 如果要串接發票系統：建議加入

---

### 4. 簽名/印章驗證缺失

**問題描述：**
- 個人簽名和公司印章沒有強制驗證
- 使用者可能未簽名/上傳印章就送出

**目前狀態：**
- StepThree 有標示為必填（*）
- 但沒有實際驗證邏輯
- 只驗證 `agreeTerms` checkbox

**影響：**
- 可能收到沒有簽名的報價單
- 法律效力可能不足

**建議修正：**
在送出前檢查：
- 個人：`formData.signature` 必須有值
- 公司選擇「上傳印章」：`formData.stampFile` 必須有值
- 公司選擇「專人聯繫」：可通過（不需上傳）

---

## 💛 輕微問題（建議改進）

### 5. 價格計算邏輯疑問

**問題描述：**
在 `priceCalculator.ts` 中：

```typescript
const addonPrice = addons.reduce((sum, addonKey) => {
  return sum + (CONFIG.ADDONS[addonKey].price * totalStores);
}, 0);
```

**疑問：**
- 加購項目價格是否應該乘以店家數量？
- 例如：「店家推薦文」NT$3,500，如果有3家店，是否應該是 3,500 × 3 = 10,500？

**目前行為：**
- ✅ 基本方案價格：不會乘以店家數
- ❓ 加購項目價格：會乘以總店家數
- ✅ 多店家加價：正確計算額外店家費用

**需要確認：**
這是否符合您的定價邏輯？

**範例計算：**
- 選擇「活動價-1年」（NT$999）
- 加購「店家推薦文」（NT$3,500）
- 多店家：2家額外店家（每家 NT$999）

目前計算：
- 方案價格：999
- 加購價格：3,500 × (1 + 2) = 10,500 ← **這裡**
- 多店家加價：999 × 2 = 1,998
- 總計：999 + 10,500 + 1,998 = 13,497

是否應該改為：
- 加購價格：3,500（不乘以店家數）
- 總計：999 + 3,500 + 1,998 = 6,497

---

### 6. 錯誤訊息只在 Console

**問題描述：**
- 所有錯誤訊息只顯示在 Console
- 使用者看不到錯誤提示（除了基本的 alert）

**影響：**
- 使用者不知道發生什麼問題
- 無法自行排除問題

**建議改進：**
- 在畫面上顯示友善的錯誤訊息
- 提供明確的解決建議
- 例如：「網路連線失敗，請檢查網路後重試」

---

### 7. 沒有資料暫存功能

**問題描述：**
- 使用者填寫到一半重新整理頁面，資料會全部消失
- 沒有使用 localStorage 或 sessionStorage

**影響：**
- 使用者體驗不佳
- 可能需要重新填寫所有資料

**建議改進：**
```typescript
// 自動儲存到 localStorage
useEffect(() => {
  localStorage.setItem('quoteFormData', JSON.stringify(formData));
}, [formData]);

// 頁面載入時復原
useEffect(() => {
  const saved = localStorage.getItem('quoteFormData');
  if (saved) {
    setFormData(JSON.parse(saved));
  }
}, []);
```

---

### 8. 圖片壓縮未實際實作

**問題描述：**
- CONFIG 中定義了圖片壓縮設定：
  ```typescript
  UPLOAD: {
    maxSize: 2 * 1024 * 1024,
    allowedTypes: ['image/png', 'image/jpeg', 'image/jpg'],
    compressQuality: 0.8,  // ← 這個
    maxWidth: 800,          // ← 和這些
    maxHeight: 800
  }
  ```
- 但實際上沒有使用這些設定進行壓縮

**目前行為：**
- ✅ 檢查檔案大小（2MB）
- ✅ 檢查檔案類型
- ❌ 沒有自動壓縮過大的圖片
- ❌ 沒有調整圖片尺寸

**影響：**
- 上傳大圖片會導致：
  - 網路傳輸慢
  - Google Apps Script 可能超時
  - 儲存空間浪費

**建議：**
- 加入圖片壓縮功能
- 或移除未使用的 CONFIG 設定

---

### 9. Google Drive 資料夾 ID 驗證

**問題描述：**
- 使用者可以輸入任意字串作為資料夾 ID
- 沒有驗證格式
- Google Apps Script 會嘗試存取，失敗後靜默處理

**建議改進：**
- 加入格式驗證（Drive 資料夾 ID 的格式）
- 或提供「測試連線」按鈕
- 或在送出前提示使用者

---

### 10. 服務條款文字有誤

**問題描述：**
在 StepThree.tsx 中，服務條款有許多文字似乎有錯別字或不完整：

```typescript
<li>若店家使用 AI 生成圖片或內容，應自行確認不涉及侵權，遵反著作法，或具有使用權；如因素材侵權或造成違規之事實，檢單或爭議，本平台（美日搜達）不予擔任何法律責任。</li>
```

**發現的問題：**
- 「遵反著作法」→ 應該是「違反著作法」
- 「檢單或爭議」→ 意思不清楚
- 還有多處文字不通順

**建議：**
請重新檢視所有服務條款文字，確保：
- 沒有錯別字
- 語句通順
- 法律用語正確

---

## ✅ 運作正常的功能

1. ✅ **前端表單流程**
   - 三步驟切換正常
   - 表單欄位綁定正確
   - UI/UX 設計良好

2. ✅ **客戶類型切換**
   - 公司/個人切換正常
   - 動態顯示對應欄位

3. ✅ **方案選擇**
   - 單選正常
   - 價格顯示正確
   - UI 回饋良好

4. ✅ **加購項目**
   - 多選功能正常
   - 價格累加正確（需確認邏輯）

5. ✅ **多店家功能**
   - 開關正常
   - 數量輸入正常
   - 價格計算正確（需確認邏輯）

6. ✅ **簽名板功能**
   - Canvas 繪製正常
   - 觸控支援正常
   - 清除功能正常
   - Base64 轉換正常

7. ✅ **印章上傳**
   - 拖曳上傳正常
   - 點擊上傳正常
   - 檔案大小驗證正常
   - 檔案類型驗證正常
   - 預覽功能正常

8. ✅ **用印方式選擇**
   - 單選正常
   - 條件顯示正常

9. ✅ **條款同意**
   - Checkbox 正常
   - 必填驗證正常

10. ✅ **錯誤處理（基礎）**
    - try-catch 包裹正常
    - Console 日誌詳細
    - 錯誤提示（Console）完整

---

## 📊 問題優先級總結

### 🔴 必須立即修正（阻礙系統運作）

1. **Google Apps Script 缺少 doGet 函式**
   - 優先級：P0（最高）
   - 阻礙：無法測試和驗證系統
   - 修正時間：5分鐘

### ⚠️ 建議修正（影響使用品質）

2. **表單驗證不完整**
   - 優先級：P1
   - 影響：可能送出不完整資料
   - 修正時間：30分鐘

3. **簽名/印章驗證缺失**
   - 優先級：P1
   - 影響：可能收到無簽名報價單
   - 修正時間：20分鐘

4. **價格計算邏輯確認**
   - 優先級：P1
   - 影響：價格可能不正確
   - 修正時間：需確認商業邏輯

### 💡 可選改進（提升使用體驗）

5. **錯誤訊息顯示**
   - 優先級：P2
   - 修正時間：1小時

6. **資料暫存功能**
   - 優先級：P2
   - 修正時間：30分鐘

7. **圖片壓縮功能**
   - 優先級：P3
   - 修正時間：2小時

8. **統一編號嚴謹驗證**
   - 優先級：P3
   - 修正時間：1小時

9. **Drive 資料夾驗證**
   - 優先級：P3
   - 修正時間：30分鐘

10. **服務條款文字修正**
    - 優先級：P2
    - 修正時間：需要您提供正確文字

---

## 🎯 建議修正順序

### 立即修正（今天）

1. ✅ 複製完整的 Google Apps Script 程式碼（包含 doGet）
2. ✅ 重新部署並測試
3. ✅ 確認價格計算邏輯是否正確

### 短期修正（本週）

4. 加入表單驗證（必填欄位檢查）
5. 加入簽名/印章驗證
6. 改善錯誤訊息顯示（在畫面上）
7. 修正服務條款文字

### 長期改進（可選）

8. 加入資料暫存功能（localStorage）
9. 加入圖片自動壓縮
10. 加入統一編號檢查碼驗證
11. 加入 Drive 資料夾 ID 驗證

---

## 🧪 測試建議

完成修正後，請測試以下情境：

### 測試案例 1：完整流程（個人）
1. 選擇「個人」
2. 填寫所有必填欄位
3. 選擇方案
4. 簽名
5. 同意條款
6. 送出
7. 檢查 Google Sheet 是否有資料

### 測試案例 2：完整流程（公司 - 上傳印章）
1. 選擇「公司行號」
2. 填寫公司名稱、統一編號
3. 選擇方案 + 加購項目
4. 選擇「上傳印章檔」
5. 上傳印章圖片
6. 同意條款
7. 送出
8. 檢查 Google Sheet 和 Drive

### 測試案例 3：完整流程（公司 - 專人聯繫）
1. 選擇「公司行號」
2. 填寫資料
3. 選擇「專人聯繫」
4. 同意條款
5. 送出

### 測試案例 4：多店家
1. 填寫基本資料
2. 勾選「需要多店家刊登」
3. 輸入額外店家數量：2
4. 檢查價格計算是否正確
5. 完成送出

### 測試案例 5：錯誤處理
1. 故意輸入錯誤的 Google Script URL
2. 送出表單
3. 確認錯誤訊息清楚明確

---

## 📞 需要您的決定

以下問題需要您的商業決策：

1. **價格計算邏輯**
   - 加購項目是否要乘以店家數量？
   - 目前：會乘
   - 需確認

2. **驗證強度**
   - 是否需要統一編號檢查碼驗證？
   - 是否需要 Drive 資料夾權限測試？

3. **服務條款**
   - 請提供正確的服務條款文字

4. **圖片處理**
   - 是否需要自動壓縮圖片？
   - 或維持目前的 2MB 限制即可？

---

## ✅ 總結

**系統整體評估：** 👍 良好

- ✅ 前端功能完整
- ✅ UI/UX 設計優秀
- ✅ 基本流程正常
- ⚠️ 需要加強驗證
- 🔴 Google Script 需要加入 doGet 函式

**最關鍵的問題：**
請立即將 `google-apps-script-example.js` 的完整內容複製到您的 Google Apps Script 編輯器中，並重新部署！
